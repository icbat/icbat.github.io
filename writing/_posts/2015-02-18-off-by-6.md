---
layout: post
title: Off by 6 - the most subtle bug I've seen to date
---

I'm still a (very) young and naive developer, but this is the worst bug I've uncovered so far.

All examples below have been reconstructed from memory to try and communicate the gist of the idea.

## The problem:  E-905

- v2b
- thousand foot view
- No logs

I'd been on this team for 2-3 months when this issue first popped up. If my last group was a raging house fire, this new home was [London in 1666](https://en.wikipedia.org/wiki/Great_Fire_of_London). So the concepts of "production issue unsolved for a few weeks" and "workaround requires 8+ hours of manual intervention" was an uncomfortable familiarity at this point. 

- bill starting


## RAP

- I work on RAP w/ Matt
- Oh hello, BS box!

## Steps to reproduce

- picking back up from cold trail
- 7 types of 905 error
- talk to deb, make list of exactly all the cases
- start to draw the picture for exactly what our process is
- now we know RAP does v2b too

## Logs!

- There's a seccond V2b! who'd have thought?
- there are logs on this box
- this is where Matt was telling us to look!
- Negative dates from the log!

## Epiphany

So we're sending bad data through to the other system. Where are those coming from, though? The dates on the business object itself seem fine; they're formatted the same as successful transactions and the numbers all seem sane. That's the kind of thing manual intervention often picks up; we're used to seeing users enter things incorrectly, with no care. That wasn't the case here, so where do those come from, anyway? Now we've got logs and line numbers, we found the following snippets:

{% gist icbat/ed53c7ac698ff714726b %}

Negative dates don't make much sense, but in the context of the code, this'll get you pretty close. But this should fail every single time, right? It should've been failing since this code was written! No code changes were made!

A six hour difference is a very big red flag where I'm from, though. This team struggles with this all the time. One of our systems is in UTC, the other is in local time, which is UTC-6. _Well, butts_. We ran a quick `date` command on each system (BS and Node1), and they were indeed in different time zones. 
